# 📧 دليل إعداد Resend API للمتجر الإلكتروني

## 🎯 خطوات الحصول على Resend API Key

### الخطوة 1: إنشاء حساب Resend
1. توجه إلى [resend.com](https://resend.com)
2. انقر على **Sign Up** لإنشاء حساب جديد
3. أدخل بياناتك (الإيميل وكلمة المرور)
4. تأكيد الحساب عبر الإيميل المرسل إليك

### الخطوة 2: الحصول على API Key
1. بعد تسجيل الدخول، انتقل إلى **API Keys** في الشريط الجانبي
2. انقر على **Create API Key**
3. أعطِ اسماً للمفتاح (مثل: "Afaq Store API")
4. اختر الصلاحيات:
   - **Sending access**: للإرسال فقط (الأفضل للأمان)
   - **Full access**: صلاحيات كاملة
5. انسخ المفتاح فوراً (لن تتمكن من رؤيته مرة أخرى!)

### الخطوة 3: إعداد المشروع

#### تحديث ملف `.env.local`
```bash
# استبدل YOUR_ACTUAL_RESEND_API_KEY بالمفتاح الحقيقي
RESEND_API_KEY=re_your_actual_api_key_here
TO_EMAIL=info@afaqinfotech.com
FROM_EMAIL=onboarding@resend.dev
```

**⚠️ ملاحظات مهمة:**
- **FROM_EMAIL**: استخدم `onboarding@resend.dev` للاختبار المجاني
- **TO_EMAIL**: الإيميل الذي ستصل إليه الطلبات (يمكن أي إيميل)
- لا تشارك API Key مع أحد أو ترفعه على Git

## 🎁 الخطة المجانية
- **3,000 إيميل شهرياً** مجاناً
- **100 إيميل يومياً** كحد أقصى
- مثالي للمتاجر الصغيرة والمتوسطة

## 🧪 الاختبار

### 1. اختبار عبر صفحة الويب
انتقل إلى: `/test-email` في المتصفح

### 2. اختبار عبر cURL
```bash
curl -X POST http://localhost:3000/api/send-order \
-H "Content-Type: application/json" \
-d '{
  "customerData": {
    "fullName": "أحمد السعد",
    "email": "ahmed@example.com",
    "phone": "+966501234567"
  },
  "cartItems": [
    {"name": "تصميم موقع", "quantity": 1, "price": 2500}
  ],
  "totalPrice": 2500
}'
```

## 🔧 إعداد الدومين المخصص (اختياري)

للحصول على إيميل بدومين مخصص:

### الخطوة 1: إضافة الدومين
1. في لوحة تحكم Resend، انتقل إلى **Domains**
2. انقر على **Add Domain**
3. أدخل اسم الدومين (مثل: `afaqinfotech.com`)

### الخطوة 2: إعداد DNS Records
أضف هذه السجلات في إعدادات DNS لدومينك:

```
Type: MX
Name: @
Value: feedback-smtp.us-east-1.amazonses.com
Priority: 10

Type: TXT
Name: @
Value: (القيمة التي يعطيها Resend)

Type: CNAME
Name: (كما هو محدد من Resend)
Value: (القيمة المحددة من Resend)
```

### الخطوة 3: التحقق من الدومين
1. بعد إضافة السجلات، انقر على **Verify Domain**
2. انتظر حتى يتم التحقق (قد يستغرق بضع ساعات)

### الخطوة 4: تحديث الكود
```bash
# في ملف .env.local
FROM_EMAIL=noreply@afaqinfotech.com
```

## 📊 مراقبة الإرسال

### في لوحة تحكم Resend:
- **Logs**: لمتابعة حالة كل إيميل
- **Analytics**: إحصائيات التسليم والفتح
- **Events**: تفاصيل كل عملية إرسال

## 🚨 استكشاف الأخطاء

### المشاكل الشائعة:

#### 1. خطأ 403 Forbidden
```
السبب: API Key خاطئ أو غير صحيح
الحل: تأكد من نسخ API Key بالكامل
```

#### 2. خطأ 422 Validation Error
```
السبب: بيانات الإيميل غير صحيحة
الحل: تأكد من صحة FROM_EMAIL و TO_EMAIL
```

#### 3. الإيميل لا يصل
```
الأسباب المحتملة:
- الإيميل في مجلد Spam
- FROM_EMAIL غير محقق
- وصول للحد اليومي (100 إيميل)
```

#### 4. Rate Limiting
```
السبب: تجاوز الحد المسموح
الحل: انتظر أو ترقية الخطة
```

## 🏆 أفضل الممارسات

### الأمان:
- لا تشارك API Key أبداً
- استخدم متغيرات البيئة
- احتفظ بنسخة احتياطية من API Key في مكان آمن

### الأداء:
- استخدم صلاحية "Sending access" فقط
- راقب استهلاكك الشهري
- استخدم قوالب HTML للإيميلات المعقدة

### المراقبة:
- تحقق من logs بانتظام
- راقب معدل التسليم
- اتبع إرشادات مكافحة Spam

## 📞 الدعم
- [وثائق Resend](https://resend.com/docs)
- [دعم Resend](https://resend.com/support)
- [مجتمع Discord](https://discord.gg/resend)

---

## ✅ التحقق النهائي

بعد اتباع هذه الخطوات، يجب أن تحصل على:
- ✅ API Key يعمل بنجاح
- ✅ إرسال إيميلات تجريبية
- ✅ وصول الإيميلات إلى البريد المحدد
- ✅ عدم ظهور أخطاء في Console

**🎉 تهانينا! نظام الإيميل أصبح جاهزاً للعمل!**